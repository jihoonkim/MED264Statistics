---
title: "Statistics for Biomedical Informatics"
author: | 
  | Department of Biomedical Informatics, UCSD
  | Jihoon Kim (j5kim@ucsd.edu)
date: "November 7, 2017"
output: beamer_presentation
---



## Understanding distribution through a permutation test
- A randomization test is a permutation test based on
randomization (random assignment).
- Its goal is to test a null hypothesis about
treatment effects in a randomized experiment. 
- Can be used when the required distributional assumptions do
NOT HOLD. 

## Permutation test algorithm
1. Compute an observed test statistic in the experiment data.
2. Permute data(=rearrange data) and compute a new test statistic. Repeat multiple times. 
3. Calculate the proportion of permuted test statistic values greater or equal to the observed one.
4. This proportion is the P-value.


## Permutation test example: Hypertension mouse model
- Systolic blood pressure was measured in 250 progeny from a backcross between two mouse strains.
- For simplicity, we focus on 50 (randomly chosen) mice genotyped at the D4Mit214 marker (although more markers were genotyped, chr4:45658442-45658566 bp, MGI:92846). 
- The question is to see if there is an association between the D4Mit214 marker genotype (binary) and blood pressure level (continuous). 
- The values  below show the systolic blood pressure (in mm of Hg) by the marker genotype, BA (heterozygous) or BB (homozygous) arranged in increasing order.
- Reference: Copeland et al. Science 1993. A genetic linkage map of the mouse: current applications and future prospects.   


## R code for permutation test with hypertension data
```{r}
het = c(86, 88, 89, 89, 92, 93, 94, 94, 94, 
      95, 95, 96, 96, 97, 97, 98, 98, 99, 
      99, 101, 106, 107, 110, 113, 116, 118)
hom = c(89, 90, 92, 93, 93, 96, 99, 99, 99, 102,
  103, 104, 105, 106, 106, 107, 108, 108, 110, 110,
  112, 114, 116, 116); set.seed(2016);
diff.obs = mean(hom) - mean(het);  n.perm=5000;
diff.perm=rep(NA, n.perm); len.het=length(het); 
len.hom=length(hom); hethom = c(het, hom)
for (i in 1 : n.perm) {
    het.perm = sample(hethom, len.het, replace=TRUE)
    hom.perm = sample(hethom, len.hom, replace=TRUE)
    diff.perm[i] = mean(hom.perm) - mean(het.perm)
 }
p.perm = sum( abs(diff.perm) >= abs(diff.obs) ) / n.perm
print(p.perm)
```

## R code for density plot
```{r, eval=FALSE}
library(ggplot2)
het = c(86, 88, 89, 89, 92, 93, 94, 94, 94, 
      95, 95, 96, 96, 97, 97, 98, 98, 99, 
      99, 101, 106, 107, 110, 113, 116, 118)
hom = c(89, 90, 92, 93, 93, 96, 99, 99, 99, 102,
  103, 104, 105, 106, 106, 107, 108, 108, 110, 110,
  112, 114, 116, 116)
cond = c(rep("het", length(het)), rep("hom", length(hom)))
dat <- data.frame( cond, val=c(het, hom) )
ggplot(dat, aes(x = val, fill = cond)) +
   geom_density(alpha = 0.5)
```

## Plot of hypertension data
```{r, echo=FALSE}
library(ggplot2)
het = c(86, 88, 89, 89, 92, 93, 94, 94, 94, 
      95, 95, 96, 96, 97, 97, 98, 98, 99, 
      99, 101, 106, 107, 110, 113, 116, 118)
hom = c(89, 90, 92, 93, 93, 96, 99, 99, 99, 102,
  103, 104, 105, 106, 106, 107, 108, 108, 110, 110,
  112, 114, 116, 116)
cond = c(rep("het", length(het)), rep("hom", length(hom)))
dat <- data.frame( cond, sbp=c(het, hom) )
ggplot(dat, aes(x = sbp, fill = cond)) +
   geom_density(alpha = 0.5)
```

## R Code for boxplot of hypertension data
```{r, eval=FALSE}
library(ggplot2)
het = c(86, 88, 89, 89, 92, 93, 94, 94, 94, 
      95, 95, 96, 96, 97, 97, 98, 98, 99, 
      99, 101, 106, 107, 110, 113, 116, 118)
hom = c(89, 90, 92, 93, 93, 96, 99, 99, 99, 102,
  103, 104, 105, 106, 106, 107, 108, 108, 110, 110,
  112, 114, 116, 116)
cond = c(rep("het", length(het)), rep("hom", length(hom)))
dat <- data.frame( cond, sbp=c(het, hom) )
ggplot(dat, aes(x=cond, y=sbp, fill=cond)) +
  geom_boxplot(notchwidth=0.3)
```



## Boxplot of hypertension data
```{r, echo=FALSE}
library(ggplot2)
het = c(86, 88, 89, 89, 92, 93, 94, 94, 94, 
      95, 95, 96, 96, 97, 97, 98, 98, 99, 
      99, 101, 106, 107, 110, 113, 116, 118)
hom = c(89, 90, 92, 93, 93, 96, 99, 99, 99, 102,
  103, 104, 105, 106, 106, 107, 108, 108, 110, 110,
  112, 114, 116, 116)
cond = c(rep("het", length(het)), rep("hom", length(hom)))
dat <- data.frame( cond, sbp=c(het, hom) )
ggplot(dat, aes(x=cond, y=sbp, fill=cond, width=0.3)) + 
  geom_boxplot()
```


## Wilcoxon rank sum test for two group comparison
```{r}
het = c(86, 88, 89, 89, 92, 93, 94, 94, 94, 
      95, 95, 96, 96, 97, 97, 98, 98, 99, 
      99, 101, 106, 107, 110, 113, 116, 118)
hom = c(89, 90, 92, 93, 93, 96, 99, 99, 99, 102,
  103, 104, 105, 106, 106, 107, 108, 108, 110, 110,
  112, 114, 116, 116)
wilcox.test(het, hom)$p.value
t.test(het, hom)$p.value
```


